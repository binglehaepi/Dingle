## QA AUDIT (2026-01-03)

본 문서는 **코드 변경 없이(검사/기록만)** 수행한 QA 감사 결과를 **누적 기록**합니다.  
원본 명령 출력은 `docs/QA_AUDIT_20260103_raw/` 아래에 저장합니다.

---

### PHASE 0: Snapshot & Structure (완료)

#### 0.1 체크포인트 파일/폴더

- **문서**: `docs/QA_AUDIT_20260103.md` (본 파일)
- **원본 로그 폴더**: `docs/QA_AUDIT_20260103_raw/`
- **원본 로그 파일**
  - `docs/QA_AUDIT_20260103_raw/log_git.txt`
  - `docs/QA_AUDIT_20260103_raw/log_scripts.txt`

#### 0.2 Git 스냅샷

- **현재 브랜치**: `electron-release`  
  - 근거: `docs/QA_AUDIT_20260103_raw/log_git.txt` L1
- **작업 트리 상태**: 변경 사항/미추적 파일 존재(Dirty)  
  - 근거: `docs/QA_AUDIT_20260103_raw/log_git.txt` L6-L61
- **최근 커밋(요청: 3개 / 실제 로그 파일에 기록된 항목: 2개)**  
  - 근거: `docs/QA_AUDIT_20260103_raw/log_git.txt` L63-L64  
  - 비고: `git log --oneline -n 3` 실행 결과가 raw 파일에 2줄로만 남아 있음(추가 원인 판단은 PHASE 0에서는 보류).

#### 0.3 `package.json` scripts 매핑

요약 표는 **실행 커맨드 문자열 기반**으로만 작성했습니다(추측 금지).  
근거 원본: `docs/QA_AUDIT_20260103_raw/log_scripts.txt` L1-L15

| script | command | 설명(커맨드 기반) | 이번 감사에서 쓸지 |
|---|---|---|---|
| `dev` | `vite` | Vite 개발 서버 실행 | PHASE0: 미사용(후속 후보) |
| `build` | `vite build` | Vite 프로덕션 빌드 | PHASE0: 미사용(후속 후보) |
| `preview` | `vite preview` | 빌드 결과 프리뷰 서버 | PHASE0: 미사용(후속 후보) |
| `ui:selftest` | `node scripts/uiSelftest.mjs` | UI SelfTest 스크립트 실행 | PHASE0: 미사용(후속 후보) |
| `electron:compile` | `tsc -p electron/tsconfig.json` | Electron(ts) 컴파일 | PHASE0: 미사용(후속 후보) |
| `electron:dev` | `concurrently "vite" "wait-on http://localhost:3000 && npm run electron:compile && electron ."` | Vite + Electron 개발 실행 | PHASE0: 미사용(후속 후보) |
| `electron:build` | `vite build && npm run electron:compile && electron-builder` | 빌드 + electron-builder 패키징 | PHASE0: 미사용(후속 후보) |
| `electron:build:mac` | `CSC_IDENTITY_AUTO_DISCOVERY=false vite build && npm run electron:compile && electron-builder --mac` | mac 타깃 패키징 | PHASE0: 미사용 |
| `electron:build:win` | `vite build && npm run electron:compile && electron-builder --win` | win 타깃 패키징 | PHASE0: 미사용 |
| `electron:build:linux` | `vite build && npm run electron:compile && electron-builder --linux` | linux 타깃 패키징 | PHASE0: 미사용 |
| `clean:xattr` | `xattr -cr . 2>/dev/null || true` | xattr 정리(유닉스 계열) | PHASE0: 미사용 |
| `clean:release` | `rm -rf release dist dist-electron` | 빌드 산출물 삭제(유닉스 계열) | PHASE0: 미사용 |
| `prebuild:signed` | `npm run clean:xattr && echo '...'` | 서명 빌드 전 정리/경고 출력 | PHASE0: 미사용 |

#### 0.4 엔트리/실행 흐름 “최소 다이어그램”

요구 범위: `index.tsx` → `App.tsx` → Desktop/Mobile 분기까지만.

#### 다이어그램(텍스트)

`index.tsx`  
→ `App.tsx`  
→ `useDeviceMode()` 결과로 `isMobile` 결정  
→ `isMobile === true`이면 `<MobileApp .../>` 렌더  
→ 그렇지 않으면 `<DesktopApp .../>` 렌더

#### 근거 인용(라인번호 포함)

- **엔트리에서 App 마운트**
  - 파일: `index.tsx` L1-L15

```1:15:index.tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

- **App에서 Mobile/Desktop 컴포넌트 import**
  - 파일: `App.tsx` L11-L16

```11:16:App.tsx
import { SPREAD_WIDTH, PAGE_WIDTH, DESIGN_HEIGHT, GLOBAL_SCRAP_PAGE_KEY } from './constants/appConstants';
import MobileApp from './components/mobile/MobileApp';
import DesktopApp from './components/DesktopApp';
import BackupDialog from './components/BackupDialog';
import { MusicProvider } from './music/MusicStore';
import PersistentYouTubePlayer from './components/PersistentYouTubePlayer';
```

- **모드 판별(분기 조건 생성)**
  - 파일: `App.tsx` L84-L90

```84:90:App.tsx
  // --- Device Mode ---
  const deviceMode = useDeviceMode();
  const isMobile = deviceMode === 'mobile';
  
  // --- Fit Scale ---
  const designWidth = isMobile ? PAGE_WIDTH : SPREAD_WIDTH;
  const { ref: viewportRef, scale } = useFitScale(designWidth, DESIGN_HEIGHT);
```

- **Mobile 분기**
  - 파일: `App.tsx` L205-L208, L230-L238

```205:208:App.tsx
  // --- Mobile Mode ---
  if (isMobile) {
    return (
      <MusicProvider>
```

```230:238:App.tsx
        <MobileApp
          items={filteredItems}
          currentLayout={currentLayout}
          currentDate={currentDate}
          diaryStyle={state.diaryStyle}
          textData={textData}
          setCurrentLayout={layoutHandlers.changeLayout}
          setCurrentDate={state.setCurrentDate}
          setDiaryStyle={state.setDiaryStyle}
```

- **Desktop 분기**
  - 파일: `App.tsx` L300-L305, L323-L329

```300:305:App.tsx
  return (
    <MusicProvider>
      <PersistentYouTubePlayer />
      {isSelfTest && (
        <SelfTestRunner
          items={items}
```

```323:329:App.tsx
      <DesktopApp
        // State
        items={items}
        setItems={setItems}
        currentLayout={currentLayout}
        currentDate={currentDate}
        textData={textData}
```

---

### PHASE 1: Mandatory Automated Checks (완료)

#### 1.1 원본 로그(raw) 위치

- `docs/QA_AUDIT_20260103_raw/tsc_noemit.log`
- `docs/QA_AUDIT_20260103_raw/build.log`
- `docs/QA_AUDIT_20260103_raw/ui_selftest.log`
- `docs/QA_AUDIT_20260103_raw/electron_compile.log`

#### 1.2 자동 체크 결과 요약(고정 형식)

| 항목 | 커맨드 | PASS/FAIL | 핵심 경고/에러(최대 5줄) | 영향도 |
|---|---|---|---|---|
| TypeScript (noEmit) | `npx tsc -p tsconfig.json --noEmit` | PASS | `docs/QA_AUDIT_20260103_raw/tsc_noemit.log` L1: `EXIT_CODE=0` | Low |
| Build | `npm run build` | PASS | `docs/QA_AUDIT_20260103_raw/build.log` L18: `EXIT_CODE=0`<br>`docs/QA_AUDIT_20260103_raw/build.log` L13: `(!) Some chunks are larger than 500 kB after minification. Consider:`<br>`docs/QA_AUDIT_20260103_raw/build.log` L16: `- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.` | Med |
| UI SelfTest | `npm run ui:selftest` | PASS | `docs/QA_AUDIT_20260103_raw/ui_selftest.log` L457: `EXIT_CODE=0`<br>`docs/QA_AUDIT_20260103_raw/ui_selftest.log` L6: `[browser:warning] cdn.tailwindcss.com should not be used in production...`<br>`docs/QA_AUDIT_20260103_raw/ui_selftest.log` L450: `[uiSelftest] ... DONE` | Low |
| Electron compile | `npm run electron:compile` | PASS | `docs/QA_AUDIT_20260103_raw/electron_compile.log` L5: `EXIT_CODE=0` | Low |
| Lint | `npm run lint` | 없음 | 근거: `docs/QA_AUDIT_20260103_raw/log_scripts.txt` L1-L15 (scripts 목록에 `lint` 키 없음) | Low |

---

### PHASE 2A: Static Scan (storage/cache/window) (완료)

#### 2A.0 원본 로그(raw) 위치

- `docs/QA_AUDIT_20260103_raw/scan_localStorage.log`
- `docs/QA_AUDIT_20260103_raw/scan_cache_keys.log`
- `docs/QA_AUDIT_20260103_raw/scan_window_globals.log`

#### 2A.리스크 등급 기준(명시)

- **High**: 하드코딩 키(문자열 리터럴) + 대응 상수/통합 지점 근거 없음, 또는 누적 키(프리픽스/템플릿)인데 삭제/클린업 근거를 찾지 못함(검색 결과 기준).
- **Med**: 하드코딩 키이지만 동일 키의 상수 정의가 존재(중복/불일치 위험), 또는 누적 키이되 범위가 제한적(예: 월 단위)이나 삭제 근거를 찾지 못함.
- **Low**: 상수 기반 키 사용, 또는 window 전역이 명시적으로 타입 선언/주입 경로가 확인됨.

---

#### 2A.A localStorage 전수 스캔

**전수 결과(근거 포함)는 raw 로그에 저장됨**: `docs/QA_AUDIT_20260103_raw/scan_localStorage.log`

- **상수 기반 키 정의(근거)**: `constants/appConstants.ts` L7-L12
  - `STORAGE_KEY = 'smart_scrap_diary_layout_v2'`
  - `LAYOUT_PREF_KEY = 'smart_scrap_layout_pref'`
  - `TEXT_DATA_KEY = 'smart_scrap_text_data'`
  - `STYLE_PREF_KEY = 'smart_scrap_style_pref'`
  - `LINK_DOCK_KEY = 'smart_scrap_link_dock_items'`

- **localStorage.clear 사용 여부**: 없음  
  - 근거: `docs/QA_AUDIT_20260103_raw/scan_localStorage.log` 섹션 “Pattern: localStorage.clear”

##### A-1) 하드코딩 키(문자열 리터럴) 목록

| 키 문자열 | 파일:라인 | 사용(get/set/remove) | 대응 상수 존재 여부 | 리스크(High/Med/Low) |
|---|---|---|---|---|
| `smart_scrap_text_data` | `hooks/useLayoutHandlers.ts` L156, L188 | set | **있음**: `constants/appConstants.ts` L10 (`TEXT_DATA_KEY`) | Med |

##### A-2) 상수/변수 기반 사용(분류 요약)

- **상수 기반(예: `STORAGE_KEY`, `STYLE_PREF_KEY` 등)**: 다수  
  - 근거: `docs/QA_AUDIT_20260103_raw/scan_localStorage.log` 내 `localStorage.getItem/setItem/removeItem` 결과에서 인자에 상수 식별자 사용
- **변수 기반(예: `key`, `storageKey`, `cacheKey`)**: 존재  
  - 근거: `docs/QA_AUDIT_20260103_raw/scan_localStorage.log`
    - `services/storage.ts` L103/L115/L132 (`key`)
    - `components/calendar/MarqueeField.tsx` L35/L57 (`storageKey`)
    - `components/layouts/MonthlySpread.tsx` L198/L216 (`cacheKey`)

---

#### 2A.B 캐시/누적 키 후보(dingel:* 등)

근거 로그: `docs/QA_AUDIT_20260103_raw/scan_cache_keys.log`

| 키 생성(템플릿/접두) | 생성 위치(파일:라인) | 삭제/만료/클린업 로직 근거 | “누적 가능” 표기 근거 | 리스크 |
|---|---|---|---|---|
| ``dingel:ohaasa:cache:${todayKey}:${ohaasaSign}`` | `components/layouts/MonthlySpread.tsx` L195 | 삭제/clear 호출 근거 없음: `scan_cache_keys.log` 섹션 “Pattern: localStorage.removeItem( ... dingel ... )” = No matches | **날짜(todayKey) 포함 템플릿** + 삭제 근거 없음 | High |
| ``dingel:calendarMarquee:${year}-MM`` | `components/layouts/MonthlySpread.tsx` L1200<br>`components/calendar/MarqueeField.tsx` L35/L57 | 삭제/clear 호출 근거 없음: `scan_cache_keys.log` 동일 섹션 = No matches | **월 단위 키(년-월)** + 삭제 근거 없음 | Med |

비고(추측 금지/근거 기반):
- `services/storage.ts`는 `localStorage.removeItem(key)` 유틸을 제공하지만(`services/storage.ts` L130-L133), **위 `dingel:*` 키로 호출되는지 여부는 본 PHASE의 검색 근거만으로는 확인되지 않음**.

---

#### 2A.C window 전역 의존/플래그 전수

근거 로그: `docs/QA_AUDIT_20260103_raw/scan_window_globals.log`

##### C-1) 전역 set(주입/할당) 위치 표

| 전역 | set 위치(파일:라인) | reset/수명 관리 근거 |
|---|---|---|
| `window.electron` | `electron/preload.ts` L15 (`contextBridge.exposeInMainWorld('electron', ...)`) | preload 주입(수명은 Electron renderer lifecycle에 종속): `electron/preload.ts` L15-L56 |
| `window.__dsd_isInteracting` | `components/DesktopApp.tsx` L100-L106 | cleanup(언마운트 시 reset) 코드 근거 없음: `components/DesktopApp.tsx` L100-L106 (return cleanup 없음) |
| `window.__dsd_isDraggingItem` | `components/mobile/MobileApp.tsx` L67-L74 | cleanup(언마운트 시 reset) 코드 근거 없음: `components/mobile/MobileApp.tsx` L67-L74 (return cleanup 없음) |
| `window.open` (SelfTest 전용 override) | `components/SelfTestRunner.tsx` L814 (override)<br>`components/SelfTestRunner.tsx` L828 (origOpen으로 복구) | **reset 있음**: `components/SelfTestRunner.tsx` L828 |

##### C-2) 전역 read(참조) 위치 표

| 전역 | read 위치(파일:라인) |
|---|---|
| `window.electron` | `App.tsx` L96<br>`services/apiClient.ts` L272<br>`hooks/useFileSync.ts` L62/L141/L193/L226<br>`components/DesktopApp.tsx` L312/L314/L639/L655<br>`services/fileStorage.ts` L22/L26/L34/L38/L66/L88/L108/L117/L124/L168/L176/L187/L193/L219/L283/L291/L298/L309/L346/L352/L390/L396/L403<br>`components/BackupDialog.tsx` L66/L97/L122/L157/L168 |
| `window.twttr` | `components/items/TwitterEmbedCard.tsx` L19/L110 |
| `window.__dsd_isInteracting / __dsd_isDraggingItem` | `utils/linkCardNav.ts` L21 |

##### C-3) window 커스텀 타입 선언(정적 근거)

| 항목 | 파일:라인 |
|---|---|
| `Window.electron?: ElectronAPI` | `src/types/electron.d.ts` L74-L78 |
| `Window.twttr: any` | `src/types/thirdParty.d.ts` L6-L15 |

비고(추측 금지/근거 기반):
- `window.twttr` **직접 할당(set) 코드는 발견되지 않음**(검색 기준): `docs/QA_AUDIT_20260103_raw/scan_window_globals.log` 섹션 “Pattern: window.twttr =” = No matches.

---

### PHASE 2B: ObjectURL & Large Files (완료)

#### 2B.0 원본 로그(raw) 위치

- `docs/QA_AUDIT_20260103_raw/scan_objecturl.log`
- `docs/QA_AUDIT_20260103_raw/scan_largefiles.log`

---

#### 2B.A ObjectURL create ↔ revoke 짝 맞추기

근거 로그: `docs/QA_AUDIT_20260103_raw/scan_objecturl.log`

| 생성 위치 | 생성 변수/url 저장 위치 | 해제 위치 | 안전성(OK/의심) | 근거 |
|---|---|---|---|---|
| `App.tsx` L258 | `videoUrl` → `metadata.url` (`App.tsx` L268) + 추적(`createdObjectUrlsRef`) (`App.tsx` L47/L260-L262) | items-change cleanup: `App.tsx` L49-L67 (revoke L60)<br>unmount cleanup: `App.tsx` L69-L82 (revoke L75) | OK | `scan_objecturl.log` 섹션 3 “App.tsx” |
| `components/CreationModal.tsx` L91 | `url` → `uploadedVideo` or `uploadedImage` state (`components/CreationModal.tsx` L94-L99) | `useEffect` cleanup: `components/CreationModal.tsx` L54-L63 (revoke L58), L65-L74 (revoke L69) | OK | `scan_objecturl.log` 섹션 3 “CreationModal” |
| `services/backup.ts` L93 | `url` → `a.href` (`services/backup.ts` L96) | `setTimeout` cleanup: `services/backup.ts` L104-L107 (revoke L106) | OK | `scan_objecturl.log` 섹션 3 “backup.ts” |
| `components/PaletteEditorModal.tsx` L314 | `url` → `a.href` (`components/PaletteEditorModal.tsx` L316) | immediate: `components/PaletteEditorModal.tsx` L319 | OK | `scan_objecturl.log` 섹션 3 “PaletteEditorModal” |
| `utils/theme.ts` L74 | module var `_paperBgObjectUrl` (`utils/theme.ts` L62-L75) | replace-old: `utils/theme.ts` L64-L67 (revoke L66)<br>explicit API: `utils/theme.ts` L78-L87 (revoke L81) | OK | `scan_objecturl.log` 섹션 3 “theme.ts” |

---

#### 2B.B 대형 파일 상위 20개(라인수, TS/TSX)

근거 로그: `docs/QA_AUDIT_20260103_raw/scan_largefiles.log` L5-L27

| 순위 | 파일 | 라인수 | 800줄 이상 리스크 코멘트(일반론) | 근거 |
|---:|---|---:|---|---|
| 1 | `components/layouts/MonthlySpread.tsx` | 1370 | 800줄 이상: 변경 시 회귀 표면이 커질 수 있음(책임 분리/테스트 분할 고려 대상). | `scan_largefiles.log` L7 |
| 2 | `components/SelfTestRunner.tsx` | 955 | 800줄 이상: 테스트/도구 파일이라도 유지보수 비용 증가 가능. | `scan_largefiles.log` L8 |
| 3 | `components/PaletteEditorModal.tsx` | 881 | 800줄 이상: UI/상태/직렬화 로직이 한 파일에 모이면 변경 영향 범위가 커질 수 있음. | `scan_largefiles.log` L9 |
| 4 | `components/DesktopApp.tsx` | 777 | - | `scan_largefiles.log` L10 |
| 5 | `components/BackupDialog.tsx` | 538 | - | `scan_largefiles.log` L11 |
| 6 | `hooks/useItemHandlers.ts` | 494 | - | `scan_largefiles.log` L12 |
| 7 | `components/CreationModal.tsx` | 473 | - | `scan_largefiles.log` L13 |
| 8 | `types.ts` | 442 | - | `scan_largefiles.log` L14 |
| 9 | `services/fileStorage.ts` | 403 | - | `scan_largefiles.log` L15 |
| 10 | `App.tsx` | 398 | - | `scan_largefiles.log` L16 |
| 11 | `services/apiClient.ts` | 397 | - | `scan_largefiles.log` L17 |
| 12 | `electron/main.ts` | 368 | - | `scan_largefiles.log` L18 |
| 13 | `components/WidgetEditor.tsx` | 331 | - | `scan_largefiles.log` L19 |
| 14 | `api/scrap.ts` | 327 | - | `scan_largefiles.log` L20 |
| 15 | `components/DraggableItem.tsx` | 318 | - | `scan_largefiles.log` L21 |
| 16 | `components/mobile/MobileFAB.tsx` | 315 | - | `scan_largefiles.log` L22 |
| 17 | `components/DecorationSelector.tsx` | 309 | - | `scan_largefiles.log` L23 |
| 18 | `components/decorations/DecorationPresetOverlay.tsx` | 300 | - | `scan_largefiles.log` L24 |
| 19 | `utils/theme.ts` | 288 | - | `scan_largefiles.log` L25 |
| 20 | `services/backup.ts` | 267 | - | `scan_largefiles.log` L26 |

---

### PHASE 3: Runtime Smoke (Auto-only) (완료)

#### 3.0 원본 로그(raw) 위치

- `docs/QA_AUDIT_20260103_raw/phase3_devserver_portcheck.log`
- `docs/QA_AUDIT_20260103_raw/phase3_runtime_smoke.log`

#### 3.1 자동 수집 결과(고정 형식)

| 항목 | 커맨드/방법 | PASS/FAIL | 핵심 경고/에러(최대 5줄) | 영향도 |
|---|---|---|---|---|
| Dev server port check | PowerShell `Test-NetConnection 127.0.0.1:3000` | PASS | `phase3_devserver_portcheck.log` L8: `TcpTestSucceeded : True` | Low |
| FIRST_LOAD console scan | Playwright(headless) 콘솔 수집 | PASS | `phase3_runtime_smoke.log` L2: `console_warning_count=1`<br>`phase3_runtime_smoke.log` L3: `console_error_count=0`<br>`phase3_runtime_smoke.log` L4: Tailwind CDN production 경고 | Low |
| RELOAD console scan | Playwright(headless) reload 후 콘솔 수집 | PASS | `phase3_runtime_smoke.log` L6: `console_warning_count=2`<br>`phase3_runtime_smoke.log` L7: `console_error_count=0`<br>`phase3_runtime_smoke.log` L8-L9: Tailwind CDN production 경고 반복 | Low |
| Runtime smoke script exit | `node docs/QA_AUDIT_20260103_raw/phase3_runtime_smoke.mjs` | PASS | `phase3_runtime_smoke.log` L10: `EXIT_CODE=0` | Low |

#### 3.2 자동화 불가/미확인 체크리스트(명시)

아래 항목은 **UI 조작/셀렉터 불명확** 등으로 PASS/FAIL을 확정하지 않고 “미확인”으로 둡니다.

- [ ] (미확인) 레이아웃 전환(월/주/프리) 버튼 클릭 및 새로고침 후 유지 확인
- [ ] (미확인) 폰트 변경(UI FontSelector) 후 저장/새로고침 후 유지 확인
- [ ] (미확인) Drag/Resize 제스처(모바일/데스크탑) 충돌 없이 동작 확인
- [ ] (미확인) Electron 모드에서 파일 저장/불러오기 경로(오프라인 포함) 정상 동작 확인

---

### PHASE 4: 사용자 관점(UX/안정성) — 근거 기반 (완료)

#### 4.1 에러 시 fallback 존재 여부(근거)

- **서버(api/scrap) 실패 시 fallback 응답 반환**  
  - 근거: `api/scrap.ts` L312-L324 (`catch`에서 `res.status(200).json({ ... isEditable: true })`)
- **웹 환경에서 서버 API 실패 시 클라 로컬 메타데이터로 fallback**  
  - 근거: `services/apiClient.ts` L349-L388 (`fetch` 실패 `catch` → `return buildSafeMetadataLocally(url, type);`)
- **Electron 환경은 서버 호출 없이 로컬 메타데이터 생성**  
  - 근거: `services/apiClient.ts` L272-L275 (`if (window.electron?.isElectron) return buildSafeMetadataLocally(...)`)
- **Twitter embed 실패 시 링크 카드 fallback**  
  - 근거: `components/items/TwitterEmbedCard.tsx` L147-L150 (`if (embedFailed || !tweetId) return <LinkCardFallback .../>;`)

#### 4.2 모바일 제스처/상호작용 충돌 위험(근거 기반)

| 관찰 항목 | 근거(파일:라인) | 리스크(High/Med/Low) | 비고 |
|---|---|---|---|
| 드래그/리사이즈/회전 중 pointer 추적을 window listener로 처리하고 cleanup 수행 | `components/DraggableItem.tsx` L175-L183 (add/remove `pointermove`/`pointerup`) | Low | cleanup 근거가 명확함 |
| 브라우저 기본 터치 제스처 방지(`touchAction: 'none'`) | `components/DraggableItem.tsx` L231-L241 | Med | 스크롤/기본 제스처와의 UX 트레이드오프(자동 검증은 미확인) |
| 링크 카드 클릭 UX에서 전역 플래그로 오동작 방지 | `utils/linkCardNav.ts` L13-L24, L38-L52 | Med | 전역 플래그의 수명 관리 불명확(아래 4.3) |

#### 4.3 window 전역/플래그 수명 관리(근거 기반)

- **`window.__dsd_isInteracting` set는 있으나, unmount 시 reset 근거는 확인되지 않음(수명 불명확)**  
  - 근거: `components/DesktopApp.tsx` L99-L106 (effect 내 set, return cleanup 없음)
- **`window.__dsd_isDraggingItem` set는 있으나, unmount 시 reset 근거는 확인되지 않음(수명 불명확)**  
  - 근거: `components/mobile/MobileApp.tsx` L67-L74 (effect 내 set, return cleanup 없음)
- **`window.electron`은 preload에서 주입되는 브릿지**  
  - 근거: `electron/preload.ts` L15-L56 (`contextBridge.exposeInMainWorld('electron', ...)`)

#### 4.4 Electron/오프라인 리스크(정적 근거 기반)

| 항목 | 관찰 | 근거 | 리스크 |
|---|---|---|---|
| Web 환경에서 메타데이터는 서버 API(`/scrap`/`/unfurl`) 의존, 실패 시 로컬 fallback | 서버 실패 시 최소 메타데이터로 하향(fallback) | `services/apiClient.ts` L289-L343 (`/unfurl` 실패 fallback), L349-L388 (`/scrap` 실패 fallback) | Med |
| Tailwind CDN 사용 | 런타임/테스트에서 “production 사용 금지” 경고 발생 | `index.html` L14 (`https://cdn.tailwindcss.com`)<br>`phase3_runtime_smoke.log` L4/L8-L9 (warning)<br>`ui_selftest.log` 내 `[browser:warning] cdn.tailwindcss.com ...` (예: 기존 로그 L6) | Med |

---

### PHASE 5: 최종 보고서(형식 고정) (완료)

#### 5.1 전체 결론(한 줄)

**릴리즈 보류** — 근거: Tailwind CDN production 경고(`index.html` L14, `phase3_runtime_smoke.log` L4) + 캐시 키(`dingel:*`) 삭제/클린업 근거 부재(`scan_cache_keys.log`) + 빌드 chunk size 경고(`build.log` L13).

#### 5.2 PASS 요약(5줄)

- `npx tsc -p tsconfig.json --noEmit` PASS — `tsc_noemit.log` L1: `EXIT_CODE=0`
- `npm run build` PASS — `build.log` L18: `EXIT_CODE=0` (경고 있음: `build.log` L13)
- `npm run ui:selftest` PASS — `ui_selftest.log` L457: `EXIT_CODE=0` (경고 있음: Tailwind CDN warning 예: `ui_selftest.log` L6)
- `npm run electron:compile` PASS — `electron_compile.log` L5: `EXIT_CODE=0`
- Runtime smoke(Playwright) PASS — `phase3_runtime_smoke.log` L10: `EXIT_CODE=0` (error_count=0: L3/L7)

#### 5.3 리스크 Top 10 (증상/근거/재현/영향/우회)

| # | 증상 | 근거(파일:라인 or 로그) | 재현/검증 방법 | 영향 | 우회 |
|---:|---|---|---|---|---|
| 1 | Tailwind CDN이 production에서 경고(외부 의존) | `index.html` L14<br>`phase3_runtime_smoke.log` L4 | 자동: PHASE3 콘솔 로그 확인 | Med | (임시) 경고 무시/네트워크 차단 환경은 “미확인”으로 남김 |
| 2 | 빌드 결과 chunk 500kB 초과 경고 | `build.log` L13-L16 | 자동: `build.log` 확인 | Med | (임시) 경고 허용(성능 튜닝은 후속) |
| 3 | `dingel:ohaasa:cache:*` 템플릿 키 생성 + 삭제 근거 없음(누적 가능) | `scan_cache_keys.log` (MonthlySpread L195/L216, removeItem 매칭 없음) | 정적: `scan_cache_keys.log` 확인 | High | (임시) 사용자 안내: localStorage 수동 삭제(미확인) |
| 4 | `dingel:calendarMarquee:*` 월 단위 템플릿 키 + 삭제 근거 없음(누적 가능) | `scan_cache_keys.log` (MonthlySpread L1200, MarqueeField L57, removeItem 매칭 없음) | 정적: `scan_cache_keys.log` 확인 | Med | (임시) 동일 |
| 5 | localStorage 키가 상수와 하드코딩으로 중복 사용(불일치 위험) | `scan_localStorage.log` (useLayoutHandlers L156/L188)<br>`constants/appConstants.ts` L10 | 정적: 키 문자열 비교 | Med | (임시) 상수로 통일 제안(수정은 후속) |
| 6 | `window.__dsd_*` 플래그 reset 근거 없음(수명 불명확) | `components/DesktopApp.tsx` L99-L106<br>`components/mobile/MobileApp.tsx` L67-L74 | 미확인(자동화 불가): 언마운트/레이아웃 전환 후 플래그 상태 확인 | Med | (임시) 미확인 체크리스트 유지 |
| 7 | lint 스크립트 부재(정적 품질 게이트 부족) | `log_scripts.txt` L1-L15 (lint 없음) | 자동: scripts 목록 확인 | Low | (임시) tsc/build/selftest로 일부 커버 |
| 8 | 800줄 이상 대형 파일 3개(회귀 표면 확대) | `scan_largefiles.log` L7-L9 | 자동: 라인수 로그 확인 | Med | (임시) 변경 범위 최소화 운영 |
| 9 | Web 환경에서 서버 `/scrap`/`/unfurl` 실패 시 로컬 fallback(기능 하향) | `services/apiClient.ts` L289-L343, L349-L388 | 미확인(자동화 불가): 네트워크 차단 후 스크랩 시 동작 관찰 | Low | fallback 자체는 존재(기능 하향은 수용/문서화) |
| 10 | Twitter 위젯 로드 실패 시 embed 대신 링크 카드로 전환 | `components/items/TwitterEmbedCard.tsx` L99-L137, L147-L150 | 미확인(자동화 불가): `platform.twitter.com` 차단 후 렌더 확인 | Low | fallback(`LinkCardFallback`) 존재 |

#### 5.4 “지금 당장 고치면 좋은 최소 변경” 제안(1~5개, 제안만)

1) Tailwind CDN 제거(빌드 타임 CSS로 전환) — 근거: `index.html` L14 + 런타임 경고(`phase3_runtime_smoke.log` L4)  
2) `dingel:*` 캐시 키 TTL/클린업 추가(예: 만료/월별 정리) — 근거: `scan_cache_keys.log` (removeItem 매칭 없음)  
3) `TEXT_DATA_KEY` 하드코딩 제거(상수로 단일화) — 근거: `scan_localStorage.log` (useLayoutHandlers L156/L188)  
4) lint 스크립트 도입(최소: eslint/biome 등) — 근거: `log_scripts.txt` L1-L15  
5) 대형 파일(>800줄) 책임 분리 제안(분해 실행 금지) — 근거: `scan_largefiles.log` L7-L9

#### 5.5 다음 안정화 로드맵(30분/2시간/반나절)

- **30분**: `TEXT_DATA_KEY` 하드코딩 제거(상수 통일) + 관련 테스트/셀프테스트(있다면) 재실행  
- **2시간**: `dingel:*` 캐시 키 만료/정리(삭제/만료 근거 추가) + 회귀용 SelfTest 케이스 보강  
- **반나절**: Tailwind CDN 제거 및 번들링(경고 제거) + 빌드 chunk 분할(경고 감소)


